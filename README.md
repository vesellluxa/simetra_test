# Тестовое задание для Симетра
# ТЗ
## Цель:
- Написать скрипт для загрузки данных из Excel файла, их сохранения в базу данных PostGIS и создание API на Flask или FastAPI для доступа к этим данным.
## Шаги:
- Распарсить Excel:
- Написать скрипт на Python для парсинга данных из Excel файла. Загрузить в базу данных PostGIS
- Создать таблицу в базе данных PostGIS для хранения данных из Excel.
- Написать скрипт для загрузки данных из Excel в созданную таблицу. Создать API
- Написать веб-приложение с использованием Flask или FastAPI. Реализовать следующие эндпоинты:
- - /vehicles: GET запрос для получения всех машин с последней геометрией.
- - /vehicles/{vehicle_id}: GET запрос для получения конкретной машины с последней геометрией.
- - /vehicles/{vehicle_id}/track: GET запрос для построения трека по дате или временному диапазону для конкретной машины.
- Используйте flask или fastapi для создания API. Настройка Docker:
- Создать Dockerfile для сборки Docker-образа.
- Убедиться, что в Dockerfile прописаны все необходимые шаги для создания окружения, установки зависимостей и запуска приложения.
- Учесть возможные переменные окружения и их передачу в контейнер.
## Требования:
- Процесс парсинга Excel файла должен быть реализован в отдельной функции, принимающей путь к файлу как аргумент.
- Процесс загрузки данных в базу данных PostGIS должен быть реализован в отдельной функции, принимающей данные и параметры подключения к базе данных.
- API должно быть доступно и документировано.
- Должен быть предоставлен файл requirements.txt с зависимостями проекта.
- Приложить описание переменных окружения, если необходимо передать их в контейнер Docker, и их формат.
- Проверка работоспособности:
- Собрать Docker-образ командой docker build -t test_task . Запустить контейнер командой docker run -d -p 5473:80 test_task Проверить работу API, используя установленные эндпоинты.
- Документировать процесс сборки и запуска контейнера Docker в README файле.
## Дополнительные требования:
- В случае возникновения ошибок, приложение должно возвращать соответствующие HTTP статусы и сообщения об ошибке.
- Обеспечьте безопасность приложения, включая валидацию входных данных и защиту от SQL инъекций.
- Процесс загрузки данных в базу данных должен быть оптимизирован для работы с большим объемом данных.
# Реализация
## Описание
### Стек:
- Python 3.12
- FastAPI 0.111.0
- SQLAlchemy 2.0.28
- Alembic 1.13.1
- Uvicorn 0.27.1
- Pydantic 2.6.3
- Nginx 1.12.3
- Postgis 3.4.1
### Описание директорий
- /alembic - Директория для приложения Alembic для работы с миграциями
- /nginx - Директория для конфига Nginx
- /data - Директория для хранения excel-файлов для загрузки
- /app - Директория приложения
## Запуск проекта
- Склонировать проект:
  ```
  git clone https://github.com/vesellluxa/simetra_test.git
  ```
- Создать `.env`-файлы в основной директории и в директории `/app`. Шаблоны `.env_template` находятся в каждой из директорий.
- Запустить `docker-compose`:
    ```
    docker-compose up -d --build
    ```
- Запустить миграции:
- - Подключение к контейнеру:
  - Получение всех контейнеров:
      ```
      docker container ls    
      ```
  - Скопировать `id` контейнера с бэкендом.
  - Подключиться к контейнеру:
    ```
    docker exec -ti {id} bash    
    ```
- Запуск миграций:
  ```
  alembic upgrade head  
  ```
## Заполнение БД
После подключения к контейнеру и выполнения миграция можно заполнить БД тестовыми данными
- Находясь в директории `/app` запустить следующую команду:
  ```
  python excel_downloader.py data/data.xlsx
  ```
## Использование скрипта загрузки данных
Чтобы перенести файл в контейнер с бэкендом необходимо выполнить следующую команду:
```
docker cp /path/to/local/file mycontainer:/path/in/container/file
```
В проекте создана отдельная директория `data` для хранения файлов.
## Документация
- [OpenAPI](http://127.0.0.1:8000/redoc)
- [Swagger](http://127.0.0.1:8000/docs)
## Автор: [Шевич Алексей](https://t.me/vesellluxa)
